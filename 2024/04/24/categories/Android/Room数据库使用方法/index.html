<!DOCTYPE HTML>
<html lang="zh-CN">

<head>
    <!--Setting-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="apple-mobile-web-app-capable" content="æ¸…é£æ˜æœˆåšå®¢">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    <meta name="browsermode" content="application">
    <meta name="screen-orientation" content="portrait">
    <meta name="theme-version" content="1.3.0">
    <meta name="root" content="/">
    <link rel="dns-prefetch" href="https://Visen123.github.io">
    <!--SEO-->

<meta name="keywords" content="Android" />


<meta name="description" content="Roomæ•°æ®åº“çš„ä½¿ç”¨æ–¹æ³•ç›®å½•1ã€æ·»åŠ Roomæ•°æ®åº“çš„ä¾èµ–2ã€Entityâ€”â€”å®šä¹‰å®ä½“ç±»2.1 å®šä¹‰ä¸»é”®â€”â€”PrimaryKey2.2 å­—æ®µæ³¨è§£â€”â€”ColumnInfo3ã€Daoâ€”â€”å®šä¹‰æ•°æ®è®¿é—®å¯¹..." />


<meta name="robots" content="all" />
<meta name="google" content="all" />
<meta name="googlebot" content="all" />
<meta name="verify" content="all" />
    <!--Title-->

<title>
    
    Roomæ•°æ®åº“çš„ç®€å•ä½¿ç”¨æ–¹æ³• |
    
    æ¸…é£æ˜æœˆåšå®¢
</title>

<link rel="alternate" href="/atom.xml" title="æ¸…é£æ˜æœˆåšå®¢" type="application/atom+xml">


<link rel="icon" href="/favicon.ico">

    


<link rel="stylesheet" href="/css/bootstrap.min.css?rev=3.3.7.css">
<link rel="stylesheet" href="/css/font-awesome.min.css?rev=4.7.0.css">
<link rel="stylesheet" href="/css/style.css?rev=@@hash.css">

    
<div class="hide">
    <script type="text/javascript">
    var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
    document.write(unescape("%3Cspan class='cnzz_stat_icon_1263868967 hide' %3E%3Cscript%20src%3D%22https%3A%2F%2Fs95.cnzz.com%2Fz_stat.php%3Fweb_id%3D1272564536%22%3E%3C%2Fscript%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s19.cnzz.com/z_stat.php%3Fid%3D1263868967%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));
    </script>
</div>




    

<meta name="generator" content="Hexo 5.4.0"></head>
<!--[if lte IE 8]>
<style>
    html{ font-size: 1em }
</style>
<![endif]-->
<!--[if lte IE 9]>
<div style="ie">ä½ ä½¿ç”¨çš„æµè§ˆå™¨ç‰ˆæœ¬è¿‡ä½ï¼Œä¸ºäº†ä½ æ›´å¥½çš„é˜…è¯»ä½“éªŒï¼Œè¯·æ›´æ–°æµè§ˆå™¨çš„ç‰ˆæœ¬æˆ–è€…ä½¿ç”¨å…¶ä»–ç°ä»£æµè§ˆå™¨ï¼Œæ¯”å¦‚Chromeã€Firefoxã€Safariç­‰ã€‚</div>
<![endif]-->
<body>
    <header class="main-header"  style="background-image:url(
    /./img/beiixin.jpg)"
     >
    <div class="main-header-box">
        <a class="header-avatar" href="/" title='æ¸…é£æ˜æœˆ'>
            <img src="/img/avatar.jpg" alt="logoå¤´åƒ" class="img-responsive center-block">
        </a>
        <div class="branding">
            <!--<h2 class="text-hide">Snippetä¸»é¢˜,ä»æœªå¦‚æ­¤ç®€å•æœ‰è¶£</h2>-->
            
            <img src="/img/branding.png" alt="Snippet åšå®¢ä¸»é¢˜" class="img-responsive center-block">
            
        </div>
    </div>
</header>
    <nav class="main-navigation">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="navbar-header"><span class="nav-toggle-button collapsed pull-right" data-toggle="collapse" data-target="#main-menu" id="mnav">
                        <span class="sr-only"></span>
                        <i class="fa fa-bars"></i>
                    </span>
                    <a class="navbar-brand" href="https://Visen123.github.io">
                        æ¸…é£æ˜æœˆåšå®¢</a>
                </div>
                <div class="collapse navbar-collapse" id="main-menu">
                    <ul class="menu">
                        
                        <li role="presentation" class="text-center">
                            <a href="/"><i class="fa "></i>
                                é¦–é¡µ</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/categories/Android/"><i class="fa "></i>
                                Android</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/categories/Python/"><i class="fa "></i>
                                Python</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/categories/å°ç¨‹åº/"><i class="fa "></i>
                                å°ç¨‹åº</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/categories/HarmonyOS/"><i class="fa "></i>
                                HarmonyOS</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/categories/å‰ç«¯/"><i class="fa "></i>
                                å‰ç«¯</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/categories/åç«¯/"><i class="fa "></i>
                                åç«¯</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/categories/å·¥å…·/"><i class="fa "></i>
                                å·¥å…·</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/archives/"><i class="fa "></i>
                                æ—¶é—´è½´</a>
                        </li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>
    <section class="content-wrap">
        <div class="container">
            <div class="row">
                <main class="col-md-8 main-content m-post">
                    <p id="process"></p>
<article class="post">
    <div class="post-head">
        <h1 id="Roomæ•°æ®åº“çš„ç®€å•ä½¿ç”¨æ–¹æ³•">
            
            Roomæ•°æ®åº“çš„ç®€å•ä½¿ç”¨æ–¹æ³•
            
        </h1>
        <div class="post-meta">
    
    <span class="categories-meta fa-wrap">
        <i class="fa fa-folder-open-o"></i>
        <a class="category-link" href="/categories/Android/">Android</a>
    </span>
    
    
    <span class="fa-wrap">
        <i class="fa fa-tags"></i>
        <span class="tags-meta">
            
        </span>
    </span>
    
    
    
    <span class="fa-wrap">
        <i class="fa fa-clock-o"></i>
        <span class="date-meta">
            2024/04/24</span>
    </span>
    
    
</div>
        
        
    </div>
    
    <div class="post-body post-content">
        <p>Roomæ•°æ®åº“çš„ä½¿ç”¨æ–¹æ³•<br>ç›®å½•<br>1ã€æ·»åŠ Roomæ•°æ®åº“çš„ä¾èµ–<br>2ã€Entityâ€”â€”å®šä¹‰å®ä½“ç±»<br>2.1 å®šä¹‰ä¸»é”®â€”â€”PrimaryKey<br>2.2 å­—æ®µæ³¨è§£â€”â€”ColumnInfo<br>3ã€Daoâ€”â€”å®šä¹‰æ•°æ®è®¿é—®å¯¹è±¡<br>4ã€Databaseâ€”â€”æ•°æ®åº“<br>4.1 é€šè¿‡å›è°ƒè§‚å¯Ÿæ•°æ®åº“æ˜¯å¦åˆ›å»ºæˆåŠŸ<br>5ã€ä½¿ç”¨æ—¶æ³¨æ„ç‚¹<br>6ã€ç¼–å†™å¼‚æ­¥ DAO æŸ¥è¯¢<br>6.1 å†™å¼‚æ­¥å•æ¬¡æŸ¥è¯¢<br>6.2 ç¼–å†™å¯è§‚å¯ŸæŸ¥è¯¢<br>å‚è€ƒæ–‡æ¡£ï¼š<br>[1] ä½¿ç”¨ Room å®ä½“å®šä¹‰æ•°æ®<br>[2] ä½¿ç”¨ Android Jetpack çš„ Room éƒ¨åˆ†å°†æ•°æ®ä¿å­˜åˆ°æœ¬åœ°æ•°æ®åº“ã€‚<br>[3] å®ä½“ç±»ä»‹ç»<br>[4] RoomAPIã€ä¾èµ–<br>[5] ç¼–å†™å¼‚æ­¥DaoæŸ¥è¯¢</p>
<p>1ã€æ·»åŠ Roomæ•°æ®åº“çš„ä¾èµ–<br>//Room<br>implementation â€œandroidx.room:room-runtime:2.6.1â€<br>annotationProcessor â€œandroidx.room:room-compiler:2.6.1â€</p>
<p>//Rxjava<br>implementation â€œandroidx.room:room-rxjava3:2.6.1â€</p>
<p>Roomæ˜¯ç”±ä¸‰å¤§éƒ¨åˆ†ç»„æˆçš„ï¼š</p>
<p>Entityï¼šæ•°æ®åº“ä¸­è¡¨å¯¹åº”çš„Javaå®ä½“<br>DAOï¼šæ“ä½œæ•°æ®åº“çš„æ–¹æ³•<br>Databaseï¼šåˆ›å»ºæ•°æ®åº“</p>
<p>2ã€Entityâ€”â€”å®šä¹‰å®ä½“ç±»<br>@Entity:</p>
<p>ç”¨äºå®šä¹‰æ•°æ®åº“è¡¨ç»“æ„ã€‚<br>åŒ…å«ä»¥ä¸‹å¸¸ç”¨å±æ€§:<br>tableName: æŒ‡å®šè¡¨åã€‚<br>primaryKeys: æŒ‡å®šä¸»é”®å­—æ®µã€‚<br>indices: å®šä¹‰ç´¢å¼•ã€‚<br>foreignKeys: å®šä¹‰å¤–é”®å…³ç³»<br>é»˜è®¤æƒ…å†µä¸‹ï¼ŒRoom å°†ç±»åç§°ç”¨ä½œæ•°æ®åº“è¡¨åç§°ã€‚å¦‚æœæ‚¨å¸Œæœ›è¡¨å…·æœ‰ä¸åŒçš„åç§°ï¼Œè¯·è®¾ç½® @Entity æ³¨è§£çš„ tableName å±æ€§ã€‚</p>
<p>åŒæ ·ï¼ŒRoom é»˜è®¤ä½¿ç”¨å­—æ®µåç§°ä½œä¸ºæ•°æ®åº“ä¸­çš„åˆ—åç§°ã€‚</p>
<p>@Entity(tableName = â€œusersâ€)<br>public class User {<br>    @PrimaryKey(autoGenerate = true)<br>    public int id;</p>
<pre><code>@ColumnInfo(name = &quot;first_name&quot;)
public String firstName;

@ColumnInfo(name = &quot;last_name&quot;)
public String lastName;
</code></pre>
<p>}</p>
<p>2.1 å®šä¹‰ä¸»é”®â€”â€”PrimaryKey<br>æ¯ä¸ª Room å®ä½“éƒ½å¿…é¡»å®šä¹‰ä¸€ä¸ªä¸»é”®ï¼Œç”¨äºå”¯ä¸€æ ‡è¯†ç›¸åº”æ•°æ®åº“è¡¨ä¸­çš„æ¯ä¸€è¡Œã€‚</p>
<p>@PrimaryKey:<br>ç”¨äºæ ‡è®°ä¸»é”®å­—æ®µã€‚<br>åŒ…å«ä»¥ä¸‹å¸¸ç”¨å±æ€§:<br>autoGenerate: æ˜¯å¦è‡ªåŠ¨ç”Ÿæˆä¸»é”®å€¼ã€‚<br>æ³¨æ„ï¼šè‡ªå¢ä¸»é”®å¿…é¡»ä¸ºintå‹ã€‚<br>2.2 å­—æ®µæ³¨è§£â€”â€”ColumnInfo<br>@ColumnInfo:<br>ç”¨äºå®šä¹‰è¡¨å­—æ®µã€‚<br>åŒ…å«ä»¥ä¸‹å¸¸ç”¨å±æ€§:<br>name: æŒ‡å®šå­—æ®µåï¼Œä¹Ÿå°±æ˜¯è¡¨çš„åˆ—å<br>typeAffinity: æŒ‡å®šå­—æ®µç±»å‹ã€‚<br>defaultValueï¼šè®¾ç½®é»˜è®¤å€¼ï¼ŒæœªæŒ‡å®šå€¼æ—¶çš„é»˜è®¤å€¼<br>é€šè¿‡ typeAffinity å±æ€§,å¯ä»¥æŒ‡å®šå­—æ®µçš„æ•°æ®ç±»å‹,å¦‚ TEXTã€INTEGER ç­‰ã€‚</p>
<p>ğŸ“Œæ³¨æ„æ•°æ®éœ€è¦å‡ä¸ºPublic</p>
<p>@Entity<br>public class HistoryData {<br>    @PrimaryKey(autoGenerate = true)<br>    public int id;</p>
<pre><code>@ColumnInfo(typeAffinity = ColumnInfo.TEXT)
public LocalDate birthDate;

@ColumnInfo(name = &quot;Name&quot;)
public String name;

@ColumnInfo(defaultValue = &quot;18&quot;)
public int age;
</code></pre>
<p>}</p>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­,birthDate å­—æ®µåœ¨æ•°æ®åº“ä¸­ä¼šè¢«å­˜å‚¨ä¸º TEXT ç±»å‹ã€‚</p>
<p>3ã€Daoâ€”â€”å®šä¹‰æ•°æ®è®¿é—®å¯¹è±¡<br>å¸¸ç”¨æ³¨è§£åŒ…æ‹¬ï¼š</p>
<p>@Query:<br>ç”¨äºå®šä¹‰æ•°æ®åº“æŸ¥è¯¢è¯­å¥ã€‚<br>å¯ä»¥è¿”å› Flowableã€Observableã€Singleã€Maybe ç­‰ RxJava ç±»å‹ã€‚<br>@Insertã€@Updateã€@Delete:<br>ç”¨äºå®šä¹‰æ•°æ®åº“å¢ã€æ”¹ã€åˆ æ“ä½œã€‚<br>å¯ä»¥è¿”å› longã€intã€void ç­‰ç±»å‹,è¡¨ç¤ºå—å½±å“çš„è¡Œæ•°ã€‚<br>@Dao<br>public interface HistoryDao {</p>
<pre><code>/**
 * å‘æ•°æ®åº“æ·»åŠ æ•°æ®
 *
 * @param data
 */
@Insert
void insertData(HistoryData data);


/**
 * åˆ é™¤æ•°æ®åº“æ‰€æœ‰æ•°æ®
 */
@Query(&quot;DELETE FROM HistoryData&quot;)
void deleteDataAll();
</code></pre>
<p>}</p>
<p>4ã€Databaseâ€”â€”æ•°æ®åº“<br>ä»¥ä¸‹ä»£ç å®šä¹‰äº†ç”¨äºä¿å­˜æ•°æ®åº“çš„ HistoryDatabase ç±»ã€‚ HistoryDatabase å®šä¹‰æ•°æ®åº“é…ç½®ï¼Œå¹¶ä½œä¸ºåº”ç”¨å¯¹æŒä¹…æ€§æ•°æ®çš„ä¸»è¦è®¿é—®ç‚¹ã€‚æ•°æ®åº“ç±»å¿…é¡»æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š</p>
<p>è¯¥ç±»å¿…é¡»å¸¦æœ‰ @Database æ³¨è§£ï¼Œè¯¥æ³¨è§£åŒ…å«åˆ—å‡ºæ‰€æœ‰ä¸æ•°æ®åº“å…³è”çš„æ•°æ®å®ä½“çš„ entities æ•°ç»„ã€‚<br>è¯¥ç±»å¿…é¡»æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œç”¨äºæ‰©å±• RoomDatabaseã€‚<br>å¯¹äºä¸æ•°æ®åº“å…³è”çš„æ¯ä¸ª DAO ç±»ï¼Œæ•°æ®åº“ç±»å¿…é¡»å®šä¹‰ä¸€ä¸ªå…·æœ‰é›¶å‚æ•°çš„æŠ½è±¡æ–¹æ³•ï¼Œå¹¶è¿”å› DAO ç±»çš„å®ä¾‹ã€‚<br>@Database(entities = HistoryData.class, version = 1)<br>public abstract class HistoryDatabase extends RoomDatabase {<br>    public abstract HistoryDao historyDao();<br>}</p>
<p>è¯·æ³¨æ„ï¼š</p>
<p>ğŸ“Œå¦‚æœæ‚¨çš„åº”ç”¨åœ¨å•ä¸ªè¿›ç¨‹ä¸­è¿è¡Œï¼Œåœ¨å®ä¾‹åŒ– HistoryDatabase å¯¹è±¡æ—¶åº”éµå¾ªå•ä¾‹è®¾è®¡æ¨¡å¼ã€‚æ¯ä¸ª RoomDatabase å®ä¾‹çš„æˆæœ¬ç›¸å½“é«˜ï¼Œè€Œæ‚¨å‡ ä¹ä¸éœ€è¦åœ¨å•ä¸ªè¿›ç¨‹ä¸­è®¿é—®å¤šä¸ªå®ä¾‹ã€‚</p>
<p>ç”¨æ³•ä¸¾ä¾‹ï¼š</p>
<p>@Database(entities = HistoryData.class, version = 1)<br>public abstract class HistoryDatabase extends RoomDatabase {</p>
<pre><code>private static volatile HistoryDatabase historyDB = null;

//å•ä¾‹æ¨¡å¼åŒæ£€é”
public static HistoryDatabase getInstance(Context context) &#123;
    if (historyDB == null) &#123;
        synchronized (HistoryDatabase.class) &#123;
            if (historyDB == null) &#123;
                historyDB = Room.databaseBuilder(context.getApplicationContext(), HistoryDatabase.class, &quot;location_History&quot;).build();
            &#125;
        &#125;
    &#125;
    return historyDB;
&#125;

public abstract HistoryDao historyDao();
</code></pre>
<p>}</p>
<p>ğŸ“Œå¦‚æœæ‚¨çš„åº”ç”¨åœ¨å¤šä¸ªè¿›ç¨‹ä¸­è¿è¡Œï¼Œè¯·åœ¨æ•°æ®åº“æ„å»ºå™¨è°ƒç”¨ä¸­åŒ…å« enableMultiInstanceInvalidation()ã€‚è¿™æ ·ï¼Œå¦‚æœæ‚¨åœ¨æ¯ä¸ªè¿›ç¨‹ä¸­éƒ½æœ‰ä¸€ä¸ª AppDatabase å®ä¾‹ï¼Œå¯ä»¥åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­ä½¿å…±äº«æ•°æ®åº“æ–‡ä»¶å¤±æ•ˆï¼Œå¹¶ä¸”è¿™ç§å¤±æ•ˆä¼šè‡ªåŠ¨ä¼ æ’­åˆ°å…¶ä»–è¿›ç¨‹ä¸­ AppDatabase çš„å®ä¾‹ã€‚</p>
<p>ç”¨æ³•ä¸¾ä¾‹ï¼š</p>
<p>@Database(entities = HistoryData.class, version = 1)<br>public abstract class HistoryDatabase extends RoomDatabase {</p>
<pre><code>public static HistoryDatabase getDatabase(Context context) &#123;
    return Room.databaseBuilder(context.getApplicationContext(),
                    HistoryDatabase.class, &quot;chat_database&quot;)
            .enableMultiInstanceInvalidation()
            .build();
&#125;

public abstract HistoryDao historyDao();
</code></pre>
<p>}</p>
<p>4.1 é€šè¿‡å›è°ƒè§‚å¯Ÿæ•°æ®åº“æ˜¯å¦åˆ›å»ºæˆåŠŸ<br>é€šè¿‡RoomDatabaseæä¾›çš„Callback()å›è°ƒæ–¹æ³•è§‚æµ‹æ•°æ®åº“çŠ¶æ€ã€‚</p>
<p>Callbackæä¾›äº†ä¸‰ä¸ªå›è°ƒæ–¹æ³•ï¼šåˆ†åˆ«æ˜¯æ•°æ®åº“ç¬¬ä¸€æ¬¡è¢«åˆ›å»ºæ—¶è°ƒç”¨ï¼Œæ•°æ®åº“æ‰“å¼€æ—¶è°ƒç”¨ï¼Œæ•°æ®åº“è¢«é”€æ¯è¿ç§»åè°ƒç”¨</p>
<p>æˆ‘ä»¬åœ¨åˆ›å»ºæ•°æ®åº“æ—¶æ·»åŠ ä¸Šè¿™ä¸ªå›è°ƒæ–¹æ³•çš„å®ç°ç±»å³å¯ï¼š</p>
<p>@Database(entities = HistoryData.class, version = 1,exportSchema = false)<br>public abstract class HistoryDatabase extends RoomDatabase {<br>    public abstract HistoryDao historyDao();</p>
<pre><code>private static volatile HistoryDatabase historyDB = null;

public static HistoryDatabase getInstance(Context context) &#123;
    if (historyDB == null) &#123;
        synchronized (HistoryDatabase.class) &#123;
            if (historyDB == null) &#123;
                historyDB = Room.databaseBuilder(context, HistoryDatabase.class, &quot;locationHistory&quot;)
                        .addCallback(roomCallback)
                        .build();
            &#125;
        &#125;
    &#125;
    return historyDB;
&#125;

// å›è°ƒå‡½æ•°ï¼Œå¯åœ¨æ•°æ®åº“åˆ›å»ºã€æ‰“å¼€å’Œå…³é—­æ—¶æ‰§è¡Œæ“ä½œ
private static RoomDatabase.Callback roomCallback = new RoomDatabase.Callback() &#123;
    @Override
    public void onCreate(@NonNull SupportSQLiteDatabase db) &#123;
        super.onCreate(db);
        Log.d(&quot;HistoryDatabase&quot;, &quot;Database created successfully&quot;);
    &#125;

&#125;;
</code></pre>
<p>}</p>
<p>5ã€ä½¿ç”¨æ—¶æ³¨æ„ç‚¹<br>ä¸ºé˜²æ­¢æŸ¥è¯¢é˜»æ­¢ç•Œé¢ï¼ŒRoom ä¸å…è®¸åœ¨ä¸»çº¿ç¨‹ä¸Šè®¿é—®æ•°æ®åº“ã€‚ æ­¤é™åˆ¶æ„å‘³ç€æ‚¨å¿…é¡»å°†DAO æŸ¥è¯¢è®¾ä¸ºå¼‚æ­¥ã€‚Room åº“åŒ…å«ä¸å¤šä¸ªä¸åŒæ¡†æ¶çš„é›†æˆï¼Œä»¥æä¾›å¼‚æ­¥æŸ¥è¯¢æ‰§è¡ŒåŠŸèƒ½ã€‚</p>
<p>// åˆ›å»ºä¸€ä¸ªExecutorService<br>ExecutorService executor = Executors.newSingleThreadExecutor();</p>
<p>// æäº¤åˆ é™¤æ“ä½œåˆ°ExecutorServiceä¸­æ‰§è¡Œ<br>executor.submit(() -&gt; {<br>    HistoryData data = new HistoryData();<br>    data.setLocationName(â€œå¤©æ´¥â€);</p>
<pre><code>HistoryDatabase.getInstance(getContext()).historyDao().insertData(data);

//åœ¨ä¸»çº¿ç¨‹ä¸­æ›´æ”¹UI
runOnUiThread(() -&gt; &#123;

&#125;);
</code></pre>
<p>});</p>
<p>// å…³é—­ExecutorService<br>executor.shutdown();</p>
<p>6ã€ç¼–å†™å¼‚æ­¥ DAO æŸ¥è¯¢<br>Java ä¸ RxJava</p>
<p>å¦‚æœæ‚¨çš„åº”ç”¨ä½¿ç”¨ Java ç¼–ç¨‹è¯­è¨€ï¼Œåˆ™æ‚¨å¯ä»¥ä½¿ç”¨ RxJava æ¡†æ¶çš„ä¸“ç”¨è¿”å›ç±»å‹ç¼–å†™å¼‚æ­¥ DAO æ–¹æ³•ã€‚Room æ”¯æŒä»¥ä¸‹ RxJava 2 è¿”å›å€¼ç±»å‹ï¼š</p>
<p>å¯¹äºå•æ¬¡æŸ¥è¯¢ï¼ŒRoom 2.1 åŠæ›´é«˜ç‰ˆæœ¬æ”¯æŒ Completableã€Single<T> å’Œ Maybe<T> è¿”å›å€¼ç±»å‹ã€‚<br>å¯¹äºå¯è§‚å¯ŸæŸ¥è¯¢ï¼ŒRoom æ”¯æŒ Publisher<T>ã€Flowable<T> å’Œ Observable<T> è¿”å›å€¼ç±»å‹ã€‚<br>æ­¤å¤–ï¼ŒRoom 2.3 åŠæ›´é«˜ç‰ˆæœ¬æ”¯æŒ RxJava 3ã€‚</p>
<p>ğŸ“Œæ³¨æ„ï¼šå¦‚éœ€å°† RxJava ä¸ Room æ­é…ä½¿ç”¨ï¼Œæ‚¨å¿…é¡»åœ¨ build.gradle æ–‡ä»¶ä¸­æ·»åŠ  room-rxjava2 å·¥ä»¶æˆ– room-rxjava3 å·¥ä»¶ã€‚å¦‚éœ€äº†è§£è¯¦æƒ…ï¼Œè¯·å‚é˜…å£°æ˜ä¾èµ–é¡¹ã€‚</p>
<p>6.1 å†™å¼‚æ­¥å•æ¬¡æŸ¥è¯¢<br>å•æ¬¡æŸ¥è¯¢æ˜¯æŒ‡ä»…æ‰§è¡Œä¸€æ¬¡å¹¶åœ¨æ‰§è¡Œæ—¶è·å–æ•°æ®å¿«ç…§çš„æ•°æ®åº“æ“ä½œã€‚ä»¥ä¸‹æ˜¯å¼‚æ­¥å•æ¬¡æŸ¥è¯¢çš„ä¸€äº›ç¤ºä¾‹ï¼š</p>
<p>@Dao<br>public interface UserDao {<br>    @Insert(onConflict = OnConflictStrategy.REPLACE)<br>    public Completable insertUsers(List<User> users);</p>
<pre><code>@Update
public Completable updateUsers(List&lt;User&gt; users);

@Delete
public Completable deleteUsers(List&lt;User&gt; users);

@Query(&quot;SELECT * FROM user WHERE id = :id&quot;)
public Single&lt;User&gt; loadUserById(int id);

@Query(&quot;SELECT * from user WHERE region IN (:regions)&quot;)
public Single&lt;List&lt;User&gt;&gt; loadUsersByRegion(List&lt;String&gt; regions);
</code></pre>
<p>}</p>
<p>6.2 ç¼–å†™å¯è§‚å¯ŸæŸ¥è¯¢<br>å¯è§‚å¯ŸæŸ¥è¯¢æ˜¯æŒ‡åœ¨æŸ¥è¯¢å¼•ç”¨çš„ä»»ä½•è¡¨å‘ç”Ÿæ›´æ”¹æ—¶å‘å‡ºæ–°å€¼çš„è¯»å–æ“ä½œã€‚</p>
<p>æ‚¨å¯èƒ½éœ€è¦ç”¨åˆ°å¯è§‚å¯ŸæŸ¥è¯¢çš„ä¸€ç§æƒ…å½¢æ˜¯ï¼Œå¸®åŠ©æ‚¨åœ¨å‘åº•å±‚æ•°æ®åº“ä¸­æ’å…¥é¡¹æˆ–è€…æ›´æ–°æˆ–ç§»é™¤å…¶ä¸­çš„é¡¹æ—¶åŠæ—¶æ›´æ–°æ˜¾ç¤ºçš„åˆ—è¡¨é¡¹ã€‚ä¸‹é¢æ˜¯å¯è§‚å¯ŸæŸ¥è¯¢çš„ä¸€äº›ç¤ºä¾‹ï¼š</p>
<p>@Dao<br>public interface UserDao {<br>    @Query(â€œSELECT * FROM user WHERE id = :idâ€)<br>    public Flowable<User> loadUserById(int id);</p>
<pre><code>@Query(&quot;SELECT * from user WHERE region IN (:regions)&quot;)
public Flowable&lt;List&lt;User&gt;&gt; loadUsersByRegion(List&lt;String&gt; regions);
</code></pre>
<p>}</p>

    </div>
    <div align="center">
     <p style="text-align:center; color:orange; font-size:26px">å®‰å“å­¦ä¹ æ•™ç¨‹å…¬ä¼—å·</p>
       <img src="/./img/ercode.jpg" width="258" height="258">
     </div>
    
    <div class="reward" ontouchstart>
    <div class="reward-wrap">èµ
        <div class="reward-box">
            
            
            <span class="reward-type">
                <img class="wechat" src="/./img/reward-wepay.jpg"><b>å¾®ä¿¡æ‰“èµ</b>
            </span>
            
        </div>
    </div>
    <p class="reward-tip">
        ç¥ä½ äº‹ä¸šé¡ºå¿ƒï¼Œå¯Œè´µå‰ç¥¥ï¼Œèµèµé¼“åŠ±
    </p>
</div>
    
    <div class="post-footer">
        <div>
            
            è½¬è½½å£°æ˜ï¼š
            å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒ,éå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ Â© <a href="" target="_blank">æ¸…é£æ˜æœˆ</a>
            
            
        </div>
        <div>
            
        </div>
    </div>
</article>
<div class="article-nav prev-next-wrap clearfix">
    
    <a href="/2024/04/28/categories/Android/%E7%94%A8KotlinCompose%E6%89%93%E9%80%A0%E7%9A%84%E7%82%AB%E5%BD%A9%E6%95%88%E6%9E%9C%E5%BA%93/" class="pre-post btn btn-default" title='ç”¨KotlinComposeæ‰“é€ çš„ç‚«å½©æ•ˆæœåº“'>
        <i class="fa fa-angle-left fa-fw"></i><span class="hidden-lg">ä¸Šä¸€ç¯‡</span>
        <span class="hidden-xs">
            ç”¨KotlinComposeæ‰“é€ çš„ç‚«å½©æ•ˆæœåº“</span>
    </a>
    
    
    <a href="/2024/03/10/categories/Android/Android-Jetpack%E7%BB%84%E4%BB%B6%E7%AE%80%E4%BB%8B/" class="next-post btn btn-default" title='Android-Jetpackç»„ä»¶ç®€ä»‹'>
        <span class="hidden-lg">ä¸‹ä¸€ç¯‡</span>
        <span class="hidden-xs">
            Android-Jetpackç»„ä»¶ç®€ä»‹</span><i class="fa fa-angle-right fa-fw"></i>
    </a>
    
</div>

<div id="comments">
    
    
<div class="utteranc">
  
  <script
    src='https://utteranc.es/client.js'
    repo='yansil/snippet-comment'
    issue-term='pathname'
    issue-number=''
    theme='github-light'
    label=''
    crossorigin='anonymous'
    async
  ></script>
</div>



</div>

                </main>
                
                    <aside id="article-toc" role="navigation" class="col-md-4">
    <div class="widget">
        <h3 class="title">
            æ–‡ç« ç›®å½•
        </h3>
        
        <p>æš‚æ— ç›®å½•</p>
        
    </div>
</aside>
                
            </div>
        </div>
    </section>
    <footer class="main-footer">
    <div class="container">
        <div class="row">
        </div>
    </div>
</footer>
<a id="back-to-top" class="icon-btn hide">
    <i class="fa fa-chevron-up"></i>
</a>
    <div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="busuanzi">
    
</div>
            </div>
            <div class="col-sm-12">
                <span>Copyright &copy;
                    2021
                    
                </span> |
                <span>
                    Powered by <a href="//yansil.github.io" class="copyright-links" target="_blank" rel="nofollow">Hexo</a>
                </span>
            </div>
        </div>
    </div>
</div>




<script src="/js/app.js?rev=@@hash.js"></script>

</body>
</html>