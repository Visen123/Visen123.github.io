<!DOCTYPE HTML>
<html lang="zh-CN">

<head>
    <!--Setting-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="apple-mobile-web-app-capable" content="清风明月博客">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    <meta name="browsermode" content="application">
    <meta name="screen-orientation" content="portrait">
    <meta name="theme-version" content="1.3.0">
    <meta name="root" content="/">
    <link rel="dns-prefetch" href="https://yansil.github.io">
    <!--SEO-->

<meta name="keywords" content="Android" />


<meta name="description" content="热更新能力是Bugly为解决开发者紧急修复线上bug，而无需重新发版让用户无感知就能把问题修复的一项能力。
Bugly目前采用微信Tinker的开源方案，开发者只需要集成腾讯官网提供的Bugly..." />


<meta name="robots" content="all" />
<meta name="google" content="all" />
<meta name="googlebot" content="all" />
<meta name="verify" content="all" />
    <!--Title-->

<title>
    
    教你如何使用Bugly修复线上安卓APP存在的bug |
    
    清风明月博客
</title>

<link rel="alternate" href="/atom.xml" title="清风明月博客" type="application/atom+xml">


<link rel="icon" href="/favicon.ico">

    


<link rel="stylesheet" href="/css/bootstrap.min.css?rev=3.3.7.css">
<link rel="stylesheet" href="/css/font-awesome.min.css?rev=4.7.0.css">
<link rel="stylesheet" href="/css/style.css?rev=@@hash.css">

    
<div class="hide">
    <script type="text/javascript">
    var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
    document.write(unescape("%3Cspan class='cnzz_stat_icon_1263868967 hide' %3E%3Cscript%20src%3D%22https%3A%2F%2Fs95.cnzz.com%2Fz_stat.php%3Fweb_id%3D1272564536%22%3E%3C%2Fscript%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s19.cnzz.com/z_stat.php%3Fid%3D1263868967%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));
    </script>
</div>




    

<meta name="generator" content="Hexo 5.4.0"></head>
<!--[if lte IE 8]>
<style>
    html{ font-size: 1em }
</style>
<![endif]-->
<!--[if lte IE 9]>
<div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div>
<![endif]-->
<body>
    <header class="main-header"  style="background-image:url(
    /./img/beiixin.jpg)"
     >
    <div class="main-header-box">
        <a class="header-avatar" href="/" title='严益云'>
            <img src="/img/avatar.jpg" alt="logo头像" class="img-responsive center-block">
        </a>
        <div class="branding">
            <!--<h2 class="text-hide">Snippet主题,从未如此简单有趣</h2>-->
            
            <img src="/img/branding.png" alt="Snippet 博客主题" class="img-responsive center-block">
            
        </div>
    </div>
</header>
    <nav class="main-navigation">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="navbar-header"><span class="nav-toggle-button collapsed pull-right" data-toggle="collapse" data-target="#main-menu" id="mnav">
                        <span class="sr-only"></span>
                        <i class="fa fa-bars"></i>
                    </span>
                    <a class="navbar-brand" href="https://yansil.github.io">
                        清风明月博客</a>
                </div>
                <div class="collapse navbar-collapse" id="main-menu">
                    <ul class="menu">
                        
                        <li role="presentation" class="text-center">
                            <a href="/"><i class="fa "></i>
                                首页</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/categories/Android/"><i class="fa "></i>
                                Android</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/categories/前端/"><i class="fa "></i>
                                前端</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/categories/后端/"><i class="fa "></i>
                                后端</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/categories/工具/"><i class="fa "></i>
                                工具</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/archives/"><i class="fa "></i>
                                时间轴</a>
                        </li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>
    <section class="content-wrap">
        <div class="container">
            <div class="row">
                <main class="col-md-8 main-content m-post">
                    <p id="process"></p>
<article class="post">
    <div class="post-head">
        <h1 id="教你如何使用Bugly修复线上安卓APP存在的bug">
            
            教你如何使用Bugly修复线上安卓APP存在的bug
            
        </h1>
        <div class="post-meta">
    
    <span class="categories-meta fa-wrap">
        <i class="fa fa-folder-open-o"></i>
        <a class="category-link" href="/categories/Android/">Android</a>
    </span>
    
    
    <span class="fa-wrap">
        <i class="fa fa-tags"></i>
        <span class="tags-meta">
            
        </span>
    </span>
    
    
    
    <span class="fa-wrap">
        <i class="fa fa-clock-o"></i>
        <span class="date-meta">
            2021/06/21</span>
    </span>
    
    
</div>
        
        
    </div>
    
    <div class="post-body post-content">
        <p>热更新能力是Bugly为解决开发者紧急修复线上bug，而无需重新发版让用户无感知就能把问题修复的一项能力。</p>
<p>Bugly目前采用微信Tinker的开源方案，开发者只需要集成腾讯官网提供的Bugly SDK就可以实现自动下载补丁包、合成、并应用补丁的功能，而且可以通过管理后台让开发者对每个版本补丁进行管理。</p>
<p>教你如何使用Bugly修复线上安卓APP存在的bug_bugly</p>
<p> 为什么使用Bugly热更新呢？因为Bugly热更新有如下好处<br>1、无需关注Tinker是如何合成补丁的<br>2、无需自己搭建补丁管理后台<br>3、无需考虑后台下发补丁策略的任何事情<br>4、无需考虑补丁下载合成的时机，处理后台下发的策略<br>5、提供了更加方便集成Tinker的方式<br>6、通过HTTPS及签名校验等机制保障补丁下发的安全性<br>7、丰富的下发维度控制，有效控制补丁影响范围<br>8、提供了应用升级一站式解决方案</p>
<p>接下来教你如何使用Bugly热更新，具体操作如下</p>
<h2 id="第一步：添加插件依赖"><a href="#第一步：添加插件依赖" class="headerlink" title="第一步：添加插件依赖"></a>第一步：添加插件依赖</h2><p>工程根目录下“build.gradle”文件中添加：</p>
<p>buildscript {<br>    repositories {<br>        jcenter()<br>    }<br>    dependencies {<br>        // tinkersupport插件, 其中lastest.release指拉取最新版本，也可以指定明确版本号，例如1.0.4<br>        classpath “com.tencent.bugly:tinker-support:latest.release”<br>    }<br>}</p>
<h2 id="第二步：集成SDK"><a href="#第二步：集成SDK" class="headerlink" title="第二步：集成SDK"></a>第二步：集成SDK</h2><p>gradle配置</p>
<p>在app module的“build.gradle”文件中添加（示例配置）：</p>
<p> android {<br>        defaultConfig {<br>          ndk {<br>            //设置支持的SO库架构<br>            abiFilters ‘armeabi’ //, ‘x86’, ‘armeabi-v7a’, ‘x86_64’, ‘arm64-v8a’<br>          }<br>        }<br>      }<br>      dependencies {<br>          compile “com.android.support:multidex:1.0.1” // 多dex配置<br>          //注释掉原有bugly的仓库<br>          //compile ‘com.tencent.bugly:crashreport:latest.release’//其中latest.release指代最新版本号，也可以指定明确的版本号，例如2.3.2<br>          compile ‘com.tencent.bugly:crashreport_upgrade:latest.release’//其中latest.release指代最新版本号，也可以指定明确的版本号，例如1.2.0<br>          compile ‘com.tencent.bugly:nativecrashreport:latest.release’ //其中latest.release指代最新版本号，也可以指定明确的版本号，例如2.2.0<br>      }</p>
<p>在app module的“build.gradle”文件中添加：</p>
<p>// 依赖插件脚本<br>apply from: ‘tinker-support.gradle’<br>tinker-support.gradle内容如下所示（示例配置）：</p>
<p>apply plugin: ‘com.tencent.bugly.tinker-support’</p>
<p>def bakPath = file(“${buildDir}/bakApk/“)<br>/*在本类中需要修改：</p>
<ul>
<li>1.baseApkDir</li>
<li>2-4名称的修改</li>
<li>2.baseApk</li>
<li>3.baseApkProguardMapping</li>
<li>4.baseApkResourceMapping</li>
<li>5.tinkerId  编号必须一致</li>
<li><em>/<br>/</em>*</li>
<li>此处填写每次构建生成的基准包目录  app/build/bakApk/app-0621-21-10-33</li>
<li>/<br>def baseApkDir = “app-0621-21-10-33”</li>
</ul>
<p>/**</p>
<ul>
<li><p>对于插件各参数的详细解析请参考</p>
</li>
<li><p>/<br>tinkerSupport {</p>
<p>  // 开启tinker-support插件，默认值true<br>  enable = true</p>
<p>  // 指定归档目录，默认值当前module的子目录tinker<br>  autoBackupApkDir = “${bakPath}”</p>
<p>  // 是否启用覆盖tinkerPatch配置功能，默认值false<br>  // 开启后tinkerPatch配置不生效，即无需添加tinkerPatch<br>  overrideTinkerPatchConfiguration = true</p>
<p>  // 编译补丁包时，必需指定基线版本的apk，默认值为空<br>  // 如果为空，则表示不是进行补丁包的编译<br>  // @{link tinkerPatch.oldApk }<br>  baseApk = “${bakPath}/${baseApkDir}/app-release.apk”</p>
<p>  // 对应tinker插件applyMapping<br>  baseApkProguardMapping = “${bakPath}/${baseApkDir}/app-release-mapping.txt”</p>
<p>  // 对应tinker插件applyResourceMapping<br>  baseApkResourceMapping = “${bakPath}/${baseApkDir}/app-release-R.txt”</p>
<p>  // 构建基准包和补丁包都要指定不同的tinkerId，并且必须保证唯一性 base  patch<br>  tinkerId = “base-1.0.3”  //base-1.0.3 错误版本  patch-1.0.3 补丁版本   （1.0.3基准包和补丁包版本要一致）</p>
<p>  // 构建多渠道补丁时使用<br>  // buildAllFlavorsDir = “${bakPath}/${baseApkDir}”</p>
<p>  // 是否开启反射Application模式<br>  enableProxyApplication = false//使用SampleApplication和SampleApplicationLike<br>  //enableProxyApplication = true//使用MyApplication</p>
</li>
</ul>
<p>}</p>
<p>/**</p>
<ul>
<li><p>一般来说,无需对下面的参数做任何的修改</p>
</li>
<li><p>对于各参数的详细介绍请参考:</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/Tencent/tinker/wiki/Tinker-%E6%8E%A5%E5%85%A5%E6%8C%87%E5%8D%97">https://github.com/Tencent/tinker/wiki/Tinker-%E6%8E%A5%E5%85%A5%E6%8C%87%E5%8D%97</a></p>
</li>
<li><p>/<br>tinkerPatch {<br>  //oldApk =”${bakPath}/${appName}/app-release.apk”<br>  ignoreWarning = false<br>  useSign = true<br>  dex {</p>
<pre><code>  dexMode = &quot;jar&quot;
  pattern = [&quot;classes*.dex&quot;]
  loader = []
</code></pre>
<p>  }<br>  lib {</p>
<pre><code>  pattern = [&quot;lib/*/*.so&quot;]
</code></pre>
<p>  }</p>
<p>  res {</p>
<pre><code>  pattern = [&quot;res/*&quot;, &quot;r/*&quot;, &quot;assets/*&quot;, &quot;resources.arsc&quot;, &quot;AndroidManifest.xml&quot;]
  ignoreChange = []
  largeModSize = 100
</code></pre>
<p>  }</p>
<p>  packageConfig {<br>  }<br>  sevenZip {</p>
<pre><code>  zipArtifact = &quot;com.tencent.mm:SevenZip:1.1.10&quot;
</code></pre>
<p>//        path = “/usr/local/bin/7za”<br>  }<br>  buildConfig {</p>
<pre><code>  keepDexApply = false
  //tinkerId = &quot;1.0.1-base&quot;
  //applyMapping = &quot;$&#123;bakPath&#125;/$&#123;appName&#125;/app-release-mapping.txt&quot; //  可选，设置mapping文件，建议保持旧apk的proguard混淆方式
  //applyResourceMapping = &quot;$&#123;bakPath&#125;/$&#123;appName&#125;/app-release-R.txt&quot; // 可选，设置R.txt文件，通过旧apk文件保持ResId的分配
</code></pre>
<p>  }<br>}</p>
</li>
</ul>
<h2 id="第三步：初始化SDK"><a href="#第三步：初始化SDK" class="headerlink" title="第三步：初始化SDK"></a>第三步：初始化SDK</h2><p>enableProxyApplication = false 的情况<br>这是Tinker推荐的接入方式，一定程度上会增加接入成本，但具有更好的兼容性。</p>
<p>集成Bugly升级SDK之后，需要按照以下方式自定义ApplicationLike来实现Application的代码（以下是示例）：</p>
<p>自定义Application</p>
<p>public class SampleApplication extends TinkerApplication {<br>    public SampleApplication() {<br>        super(ShareConstants.TINKER_ENABLE_ALL, “xxx.xxx.SampleApplicationLike”,<br>                “com.tencent.tinker.loader.TinkerLoader”, false);<br>    }<br>}</p>
<p>注意：这个类集成TinkerApplication类，这里面不做任何操作，所有Application的代码都会放到ApplicationLike继承类当中<br>参数解析<br>参数1：tinkerFlags 表示Tinker支持的类型 dex only、library only or all suuport，default: TINKER_ENABLE_ALL<br>参数2：delegateClassName Application代理类 这里填写你自定义的ApplicationLike<br>参数3：loaderClassName Tinker的加载器，使用默认即可<br>参数4：tinkerLoadVerifyFlag 加载dex或者lib是否验证md5，默认为false<br>————————————————</p>
<p>需要您将以前的Applicaton配置为继承TinkerApplication的类：</p>
<p>教你如何使用Bugly修复线上安卓APP存在的bug_Bugly使用_02</p>
<p>自定义ApplicationLike</p>
<p>public class SampleApplicationLike extends DefaultApplicationLike {</p>
<pre><code>public static final String TAG = &quot;Tinker.SampleApplicationLike&quot;;

public SampleApplicationLike(Application application, int tinkerFlags,
        boolean tinkerLoadVerifyFlag, long applicationStartElapsedTime,
        long applicationStartMillisTime, Intent tinkerResultIntent) &#123;
    super(application, tinkerFlags, tinkerLoadVerifyFlag, applicationStartElapsedTime, applicationStartMillisTime, tinkerResultIntent);
&#125;


@Override
public void onCreate() &#123;
    super.onCreate();
    // 这里实现SDK初始化，appId替换成你的在Bugly平台申请的appId
    // 调试时，将第三个参数改为true
    Bugly.init(getApplication(), &quot;900029763&quot;, false);
&#125;


@TargetApi(Build.VERSION_CODES.ICE_CREAM_SANDWICH)
@Override
public void onBaseContextAttached(Context base) &#123;
    super.onBaseContextAttached(base);
    // you must install multiDex whatever tinker is installed!
    MultiDex.install(base);

    // 安装tinker
    // TinkerManager.installTinker(this); 替换成下面Bugly提供的方法
    Beta.installTinker(this);
&#125;

@TargetApi(Build.VERSION_CODES.ICE_CREAM_SANDWICH)
public void registerActivityLifecycleCallback(Application.ActivityLifecycleCallbacks callbacks) &#123;
    getApplication().registerActivityLifecycleCallbacks(callbacks);
&#125;
</code></pre>
<p>}</p>
<p>注意：tinker需要你开启MultiDex,你需要在dependencies中进行配置compile “com.android.support:multidex:1.0.1”才可以使用MultiDex.install方法； SampleApplicationLike这个类是Application的代理类，以前所有在Application的实现必须要全部拷贝到这里，在onCreate方法调用SDK的初始化方法，在onBaseContextAttached中调用Beta.installTinker(this);。</p>
<p>enableProxyApplication = true 的情况</p>
<p>public class MyApplication extends Application {</p>
<pre><code>@Override
public void onCreate() &#123;
    super.onCreate();
    // 这里实现SDK初始化，appId替换成你的在Bugly平台申请的appId
    // 调试时，将第三个参数改为true  900029763自己申请的ID
    Bugly.init(this, &quot;900029763&quot;, false);
&#125;

@Override
protected void attachBaseContext(Context base) &#123;
    super.attachBaseContext(base);
    // you must install multiDex whatever tinker is installed!
    MultiDex.install(base);


    // 安装tinker
    Beta.installTinker();
&#125;
</code></pre>
<p>}</p>
<h2 id="第四步：AndroidManifest-xml配置"><a href="#第四步：AndroidManifest-xml配置" class="headerlink" title="第四步：AndroidManifest.xml配置"></a>第四步：AndroidManifest.xml配置</h2><ol>
<li>权限配置</li>
</ol>
<uses-permission android:name="android.permission.READ_PHONE_STATE" />
<uses-permission android:name="android.permission.INTERNET" />
<uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />
<uses-permission android:name="android.permission.ACCESS_WIFI_STATE" />
<uses-permission android:name="android.permission.READ_LOGS" />
<uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" />
<uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE"/>

<h2 id="第五步：混淆配置"><a href="#第五步：混淆配置" class="headerlink" title="第五步：混淆配置"></a>第五步：混淆配置</h2><p>为了避免混淆SDK，在Proguard混淆文件中增加以下配置：</p>
<p>-dontwarn com.tencent.bugly.**<br>-keep public class com.tencent.bugly.**{*;}</p>
<p>如果你使用了support-v4包，你还需要配置以下混淆规则：</p>
<p>-keep class android.support.**{*;}</p>
<p>bugly地址：<a target="_blank" rel="noopener" href="https://bugly.qq.com/docs/user-guide/instruction-manual-android-hotfix/?v=20170322165254">https://bugly.qq.com/docs/user-guide/instruction-manual-android-hotfix/?v=20170322165254</a><br>Github Demo<br><a target="_blank" rel="noopener" href="https://github.com/BuglyDevTeam/Bugly-Android-Demo">https://github.com/BuglyDevTeam/Bugly-Android-Demo</a></p>
<p>##普通打包<br>##1、编译基准包<br>配置基准包的tinkerId</p>
<p>教你如何使用Bugly修复线上安卓APP存在的bug_热更新_03</p>
<p>inkerId最好是一个唯一标识，例如git版本号、versionName等等。 如果你要测试热更新，你需要对基线版本进行联网上报。</p>
<p>这里强调一下，基线版本配置一个唯一的tinkerId，而这个基线版本能够应用补丁的前提是集成过热更新SDK，并启动上报过联网，这样后台会将这个tinkerId对应到一个目标版本，例如tinkerId<br>= “bugly_1.0.0” 对应了一个目标版本是1.0.0，基于这个版本打的补丁包就能匹配到目标版本。</p>
<p>执行assembleRelease编译生成基准包：</p>
<p>教你如何使用Bugly修复线上安卓APP存在的bug_Bugly使用_04</p>
<p>这个会在build/outputs/bakApk路径下生成每次编译的基准包、混淆配置文件、资源Id文件，如下图所示：</p>
<p>教你如何使用Bugly修复线上安卓APP存在的bug_bugly_05</p>
<p>实际应用中，请注意保存线上发布版本的基准apk包、mapping文件、R.txt文件，如果线上版本有bug，就可以借助tinker-support插件进行补丁包的生成。</p>
<p>启动apk，上报联网数据</p>
<p>每次冷启动都会请求补丁策略，会上报当前版本号和tinkerId，这样后台就能将这个唯一的tinkerId对应到一个版本，大家测试的时候可以打开logcat查看的日志，如下图所示：</p>
<p>教你如何使用Bugly修复线上安卓APP存在的bug_bugly_06</p>
<p>如果看不到log，您需要将bugly初始化的第三个参数设置为true才能看到。<br>##2、对基线版本的bug修复<br>未修复前</p>
<p>教你如何使用Bugly修复线上安卓APP存在的bug_bugly_07</p>
<p>这个类有一个会造成空指针的方法。</p>
<p>修复后</p>
<p>教你如何使用Bugly修复线上安卓APP存在的bug_bugly_08</p>
<p>对产生bug的类进行修复，作为补丁下次覆盖基线版本的类。</p>
<p>##3、根据基线版本生成补丁包<br>修改待修复apk路径、mapping文件路径、resId文件路径</p>
<p>教你如何使用Bugly修复线上安卓APP存在的bug_安卓开发_09</p>
<p>执行构建补丁包的task</p>
<p>教你如何使用Bugly修复线上安卓APP存在的bug_Bugly使用_10</p>
<p>如果你要生成不同编译环境的补丁包，只需要执行TinkerSupport插件生成的task，比如buildTinkerPatchRelease就能生成release编译环境的补丁包。 注：TinkerSupport插件版本低于1.0.4的，需要使用tinkerPatchRelease来生成补丁包 。</p>
<p>生成的补丁包在build/outputs/patch目录下：</p>
<p>教你如何使用Bugly修复线上安卓APP存在的bug_bugly_11</p>
<p>大家这里可能会有一个疑问，补丁版本是怎么匹配到目标版本的，可以双击patch包，提供的插件会在tinker生成的patch包基础上插入一个MF文件：</p>
<p>教你如何使用Bugly修复线上安卓APP存在的bug_线上修复bug_12</p>
<p>教你如何使用Bugly修复线上安卓APP存在的bug_线上修复bug_13</p>
<p>##4、上传补丁包到平台<br>上传补丁包到平台并下发编辑规则</p>
<p>教你如何使用Bugly修复线上安卓APP存在的bug_线上修复bug_14</p>
<p>教你如何使用Bugly修复线上安卓APP存在的bug_线上修复bug_15</p>
<p>教你如何使用Bugly修复线上安卓APP存在的bug_热更新_16</p>
<p>点击发布新补丁，上传前面生成的patch包，平台会自动为你匹配到目标版本，你可以选择下发范围（开发设备、全量设备、自定义），填写完备注之后，点击立即下发让补丁生效，这样你就可以在客户端当中收到的策略，SDK会自动帮你把补丁包下到本地。</p>
<p>##5、测试补丁应用效果<br>启动app应用patch</p>
<p>教你如何使用Bugly修复线上安卓APP存在的bug_安卓开发_17</p>
<p>如果匹配到目标版本，后台就会下发补丁策略，可以在logcat看到如下日志：</p>
<p>教你如何使用Bugly修复线上安卓APP存在的bug_热更新_18</p>
<p>下载成功之后，会立即去合成补丁，可以看到patch合成的日志：</p>
<p>教你如何使用Bugly修复线上安卓APP存在的bug_bugly_19</p>
<p>##重启app查看效果</p>
<p>教你如何使用Bugly修复线上安卓APP存在的bug_线上修复bug_20</p>
<p>注：方案是基于Tinker方案的实现，需要下次启动才能让补丁生效</p>
<p>##多渠道打包</p>
<p>tinker是支持打多渠道的，建议大家按照以下步骤进行最佳实践：</p>
<p>##1. 配置productFlavors</p>
<p>android {<br>    …</p>
<pre><code>// 多渠道打包（示例配置）
productFlavors &#123;
    xiaomi &#123;
        applicationId &#39;com.tencent.bugly.hotfix.xiaomi&#39;
    &#125;

    yyb &#123;
        applicationId &#39;com.tencent.bugly.hotfix.yyb&#39;
    &#125;
&#125;
</code></pre>
<p>  …</p>
<p>}</p>
<p>##2. 执行assembleRelease生成基线apk<br>按照普通打包方式正常配置基线版本的tinkerId，然后执行assembleRelease生成不同渠道的apk，会在工程中build/bakApk/生成如下图所示文件：</p>
<p>教你如何使用Bugly修复线上安卓APP存在的bug_bugly_21</p>
<p>##3. 打渠道补丁包配置</p>
<p>教你如何使用Bugly修复线上安卓APP存在的bug_安卓开发_22</p>
<p>4.执行buildAllFlavorsTinkerPatchRelease生成所有渠道补丁包<br>如下图所示：</p>
<p>教你如何使用Bugly修复线上安卓APP存在的bug_热更新_23</p>
<p>5.测试应用补丁包<br>与普通打包一致。</p>
<p>加固打包（仅支持tinker 1.7.5及以下）</p>
<p>tinker的一般模式需要Dex的合成，它并不支持加固，一定要使用加固的app可以使用usePreGeneratedPatchDex模式。由于加固会改变apk的dex结构，所以生成补丁包时务必要使用加固前的apk。<br>但是需要注意的是，某些加固工具会将非exported的四大组件的类名替换，对于这部分类即使使用usePreGeneratedPatchDex也无法修改。对于360加固，MainActivity由于被提前加载，也无法修复。大家对于加固的情况，请仔细测试，能否支持与加固的方式有关联。</p>
<p>1.提前生成dex配置<br>tinker是支持加固模式的，但需要你回退到Qzone方案 ，将usePreGeneratedPatchDex设置为true。</p>
<p>教你如何使用Bugly修复线上安卓APP存在的bug_安卓开发_24</p>
<p>是否提前生成dex，而非合成的方式。这套方案即回退成Qzone的方案，对于需要使用加固或者多flavor打包(建议使用其他方式生成渠道包)的用户可使用。但是这套方案需要插桩，会造成Dalvik下性能损耗以及Art补丁包可能过大的问题，务必谨慎使用。另外一方面，这种方案在Android<br>N之后可能会产生问题，建议过滤N之后的用户。</p>
<p>2.将基准包进行加固<br>如果你的app需要进行加固，你需要将你打出的基准包上传到具体的加固平台进行加固，例如乐固，加固完成之后需要对apk进行重签名：</p>
<p>jarsigner -verbose -keystore <YOUR_KEYSTORE> -signedjar <SIGNED_APK> <UNSIGNED_APK> <KEY_ALIAS><br>以上命令说明：<br>-verbose：指定生成详细输出<br>-keystore：指定证书存储路径<br>-signedjar：改选项的三个参数分别为签名后的apk包、未签名的apk包、数字证书别名</p>
<p>3.根据加固的基准包生成补丁包<br>打patch包的操作跟普通打包方式一致。</p>
<p>buglySDK下载地址：<a target="_blank" rel="noopener" href="https://bugly.qq.com/v2/sdkDownload">https://bugly.qq.com/v2/sdkDownload</a></p>
<p>bugly热更新使用指南文档：<a target="_blank" rel="noopener" href="https://bugly.qq.com/docs/user-guide/api-hotfix/?v=20200622202242">https://bugly.qq.com/docs/user-guide/api-hotfix/?v=20200622202242</a></p>

    </div>
    <div align="center">
     <p style="text-align:center; color:orange; font-size:26px">安卓学习教程公众号</p>
     <img src="../img/ercode.jpg" width="258" height="258">
     </div>
    
    <div class="reward" ontouchstart>
    <div class="reward-wrap">赏
        <div class="reward-box">
            
            
            <span class="reward-type">
                <img class="wechat" src="../img/reward-wepay.jpg"><b>微信打赏</b>
            </span>
            
        </div>
    </div>
    <p class="reward-tip">
        赞赏是不耍流氓的鼓励
    </p>
</div>
    
    <div class="post-footer">
        <div>
            
            转载声明：
            商业转载请联系作者获得授权,非商业转载请注明出处 © <a href="" target="_blank">清风明月</a>
            
            
        </div>
        <div>
            
        </div>
    </div>
</article>
<div class="article-nav prev-next-wrap clearfix">
    
    <a href="/2021/08/09/categories/Android/Android9.0%E6%97%A0%E6%B3%95%E5%8A%A0%E8%BD%BD%E5%9B%BE%E7%89%87%E5%8F%8A%E8%AE%BF%E9%97%AE%E4%B8%8D%E4%BA%86%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%97%AE%E9%A2%98/" class="pre-post btn btn-default" title='Android9.0无法加载图片及访问不了服务器问题'>
        <i class="fa fa-angle-left fa-fw"></i><span class="hidden-lg">上一篇</span>
        <span class="hidden-xs">
            Android9.0无法加载图片及访问不了服务器问题</span>
    </a>
    
    
    <a href="/2021/06/20/categories/Android/Android%20Studio%E4%B8%AD%E4%BB%A3%E7%A0%81%E5%81%9A%E6%B7%B7%E6%B7%86%E6%96%B9%E6%B3%95/" class="next-post btn btn-default" title='Android Studio中代码做混淆方法'>
        <span class="hidden-lg">下一篇</span>
        <span class="hidden-xs">
            Android Studio中代码做混淆方法</span><i class="fa fa-angle-right fa-fw"></i>
    </a>
    
</div>

<div id="comments">
    
    
<div class="utteranc">
  
  <script
    src='https://utteranc.es/client.js'
    repo='yansil/snippet-comment'
    issue-term='pathname'
    issue-number=''
    theme='github-light'
    label=''
    crossorigin='anonymous'
    async
  ></script>
</div>



</div>

                </main>
                
                    <aside id="article-toc" role="navigation" class="col-md-4">
    <div class="widget">
        <h3 class="title">
            文章目录
        </h3>
        
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E6%AD%A5%EF%BC%9A%E6%B7%BB%E5%8A%A0%E6%8F%92%E4%BB%B6%E4%BE%9D%E8%B5%96"><span class="toc-text">第一步：添加插件依赖</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E6%AD%A5%EF%BC%9A%E9%9B%86%E6%88%90SDK"><span class="toc-text">第二步：集成SDK</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E6%AD%A5%EF%BC%9A%E5%88%9D%E5%A7%8B%E5%8C%96SDK"><span class="toc-text">第三步：初始化SDK</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E6%AD%A5%EF%BC%9AAndroidManifest-xml%E9%85%8D%E7%BD%AE"><span class="toc-text">第四步：AndroidManifest.xml配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%94%E6%AD%A5%EF%BC%9A%E6%B7%B7%E6%B7%86%E9%85%8D%E7%BD%AE"><span class="toc-text">第五步：混淆配置</span></a></li></ol>
        
    </div>
</aside>
                
            </div>
        </div>
    </section>
    <footer class="main-footer">
    <div class="container">
        <div class="row">
        </div>
    </div>
</footer>
<a id="back-to-top" class="icon-btn hide">
    <i class="fa fa-chevron-up"></i>
</a>
    <div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="busuanzi">
    
</div>
            </div>
            <div class="col-sm-12">
                <span>Copyright &copy;
                    2021
                    
                </span> |
                <span>
                    Powered by <a href="//yansil.github.io" class="copyright-links" target="_blank" rel="nofollow">清风明月</a>
                </span> |
                <span>
                    Theme by <a href="//yansil.github.io" class="copyright-links" target="_blank" rel="nofollow">Snippet</a>
                </span>
            </div>
        </div>
    </div>
</div>




<script src="/js/app.js?rev=@@hash.js"></script>

</body>
</html>